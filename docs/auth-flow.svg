<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="appGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="authGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6d28d9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="backendGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="secureGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow5" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="3" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
    <marker id="arrowDark" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="35" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#1e293b">Flujo de Autenticación OAuth 2.0 + JWT</text>

  <!-- Entities -->
  <rect x="50" y="70" width="160" height="100" rx="12" fill="url(#appGrad2)" filter="url(#shadow5)"/>
  <text x="130" y="110" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Mobile App</text>
  <text x="130" y="130" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="rgba(255,255,255,0.8)">Android / iOS</text>
  <text x="130" y="150" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.7)">Ktor Client</text>

  <rect x="370" y="70" width="160" height="100" rx="12" fill="url(#authGrad)" filter="url(#shadow5)"/>
  <text x="450" y="110" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Auth Server</text>
  <text x="450" y="130" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="rgba(255,255,255,0.8)">OAuth 2.0</text>
  <text x="450" y="150" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.7)">Token Provider</text>

  <rect x="690" y="70" width="160" height="100" rx="12" fill="url(#backendGrad)" filter="url(#shadow5)"/>
  <text x="770" y="110" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">API Backend</text>
  <text x="770" y="130" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="rgba(255,255,255,0.8)">REST API</text>
  <text x="770" y="150" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.7)">Protected Resources</text>

  <!-- Flow Steps -->
  <!-- Step 1: Login -->
  <line x1="210" y1="100" x2="365" y2="100" stroke="#374151" stroke-width="2" marker-end="url(#arrowDark)"/>
  <rect x="240" y="80" width="80" height="25" rx="4" fill="#f1f5f9"/>
  <text x="280" y="97" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#374151">1. Login</text>

  <!-- Step 2: Tokens -->
  <line x1="365" y1="140" x2="210" y2="140" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowPurple)"/>
  <rect x="235" y="145" width="90" height="25" rx="4" fill="#ede9fe"/>
  <text x="280" y="162" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#6d28d9">2. Tokens</text>

  <!-- Step 3: API Request -->
  <line x1="210" y1="120" x2="685" y2="120" stroke="#374151" stroke-width="2" marker-end="url(#arrowDark)"/>
  <rect x="380" y="105" width="140" height="20" rx="4" fill="#f1f5f9"/>
  <text x="450" y="119" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="#374151">3. Request + Bearer Token</text>

  <!-- Token boxes -->
  <rect x="50" y="200" width="380" height="120" rx="12" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="240" y="225" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#92400e">Tokens JWT</text>

  <rect x="70" y="240" width="160" height="65" rx="8" fill="url(#secureGrad)" filter="url(#shadow5)"/>
  <text x="150" y="265" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Access Token</text>
  <text x="150" y="283" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">Duración: 15 min</text>
  <text x="150" y="298" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.8)">En memoria</text>

  <rect x="250" y="240" width="160" height="65" rx="8" fill="url(#secureGrad)" filter="url(#shadow5)"/>
  <text x="330" y="265" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Refresh Token</text>
  <text x="330" y="283" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">Duración: 7 días</text>
  <text x="330" y="298" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.8)">Secure Storage</text>

  <!-- Secure Storage Section -->
  <rect x="470" y="200" width="380" height="120" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="660" y="225" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e40af">Almacenamiento Seguro</text>

  <rect x="490" y="240" width="160" height="65" rx="8" fill="#3b82f6" filter="url(#shadow5)"/>
  <text x="570" y="265" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Android</text>
  <text x="570" y="283" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">EncryptedSharedPrefs</text>
  <text x="570" y="298" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.8)">+ Android Keystore</text>

  <rect x="670" y="240" width="160" height="65" rx="8" fill="#3b82f6" filter="url(#shadow5)"/>
  <text x="750" y="265" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">iOS</text>
  <text x="750" y="283" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">Keychain Services</text>
  <text x="750" y="298" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.8)">Secure Enclave</text>

  <!-- Refresh Flow -->
  <rect x="50" y="350" width="800" height="130" rx="12" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
  <text x="450" y="375" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#166534">Flujo de Refresh Token</text>

  <rect x="80" y="395" width="150" height="65" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="155" y="420" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#166534">1. Token Expired</text>
  <text x="155" y="440" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#15803d">401 Unauthorized</text>

  <line x1="230" y1="427" x2="270" y2="427" stroke="#166534" stroke-width="2" marker-end="url(#arrowDark)"/>

  <rect x="270" y="395" width="150" height="65" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="345" y="420" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#166534">2. Use Refresh</text>
  <text x="345" y="440" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#15803d">POST /auth/refresh</text>

  <line x1="420" y1="427" x2="460" y2="427" stroke="#166534" stroke-width="2" marker-end="url(#arrowDark)"/>

  <rect x="460" y="395" width="150" height="65" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="535" y="420" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#166534">3. New Tokens</text>
  <text x="535" y="440" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#15803d">Store &amp; Retry Request</text>

  <line x1="610" y1="427" x2="650" y2="427" stroke="#166534" stroke-width="2" marker-end="url(#arrowDark)"/>

  <rect x="650" y="395" width="170" height="65" rx="8" fill="#fecaca" stroke="#ef4444" stroke-width="1"/>
  <text x="735" y="420" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">4. Refresh Failed?</text>
  <text x="735" y="440" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#b91c1c">Logout → Login Screen</text>
</svg>